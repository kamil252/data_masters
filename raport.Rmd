---
title: "Analiza danych - raport końcowy"
author: "Kamil Ciosek; Oskar Kanigowski; Nina Górczyńska"
date: "2025-01-19"
output: html_document
---

# Wprowadzenie

### Pożyczki

Spośród wszystkich branż, domena ubezpieczeniowa ma największe zastosowanie analityki i metod nauki o danych. Ten zestaw danych zapewni ci wystarczający przedsmak pracy nad zestawami danych z firm ubezpieczeniowych, z jakimi wyzwaniami się mierzą, jakie strategie są stosowane, jakie zmienne wpływają na wynik itp. Jest to problem klasyfikacji. Dane mają 615 wierszy i 13 kolumn.

### Problem

Firma chce zautomatyzować proces kwalifikowania się do pożyczki (w czasie rzeczywistym) w oparciu o dane klienta podane podczas wypełniania wniosku online. Dane te obejmują płeć, stan cywilny, wykształcenie, liczbę osób na utrzymaniu, dochód, kwotę pożyczki, historię kredytową i inne. Aby zautomatyzować ten proces, firma postawiła sobie za cel zidentyfikowanie segmentów klientów, którzy kwalifikują się do otrzymania kwoty pożyczki, aby móc skierować do nich konkretną ofertę. W tym przypadku dostarczono częściowy zestaw danych.

### Opis bazy danych

Baza składa się z 13 kolumn, a te z kolei zawierają następujące wartości:

1.  **Loan_ID** - indywidualny numer ID każdej obserwacji,
2.  **Gender** - informacja, jaka płeć jest przyjęta w danej obserwacji,
3.  **Married** - informacja, czy osoba jest w związku małżeńskim,
4.  **Dependents** - ilość osób zależnych (finansowo),
5.  **Education** - informacja, czy dana osoba ukończyła studia,
6.  **Self_Employed** - informacja, czy osoba jest samozatrudniona,
7.  **ApplicantIncome** - dochód wnioskodawcy o pożyczkę,
8.  **CoapplicantIncome** - dochód współwnioskodawcy o pożyczkę,
9.  **LoanAmount** - kwota pożyczki,
10. **Loan_Amount_Term** - okres kredytowania,
11. **Credit_History** - historia kredytowa,
12. **Property_Area** - obszar nieruchomości,
13. **Loan_Status** - informacja, czy udzielono kredytu 

```{r Wczytanie danych, echo=FALSE}
options(repos = c(CRAN = "https://cloud.r-project.org/"))
#wczytanie danych
data <- read.csv("dataset/raw_data.csv")
```

# 5. Analiza opisowa

Pierwszym etapem analiz wszelkiego typu danych jest ich **analiza opisowa**. Pozwala ona lepiej zrozumieć dane oraz wyciągnąć odpowienie wnioski.

**5.1. Statystyki opisowe** pomagają szybko zrozumieć, jakie wartości dominują, jak bardzo dane są zróżnicowane i czy występują jakieś nietypowe przypadki. Dzięki nim mogliśmy np. sprawdzić, jaki jest przeciętny dochód wnioskodawcy, jak bardzo dochody różnią się między aplikantami, albo czy w danych są osoby, które odstają od reszty.

```{r wczytanie nowej bazy, echo =FALSE}

data1 <- read.csv("dataset/types_of_clients_data.csv")
```

```{r Statystyki opisowe, echo=TRUE}
#Statystyki opisowe
statystyki <-
  list("IncomePerDependent" =
         list("Średnia"= ~(mean(IncomePerDependent)),
              "Mediana"= ~(median(IncomePerDependent)),
              "Odchylenie standardowe"= ~(sd(IncomePerDependent)),
              "Pierwszy kwartyl"= ~quantile(IncomePerDependent,0.25),
              "Trzeci kwartyl"= ~quantile(IncomePerDependent,0.75),
              "IQR"= ~(IQR(IncomePerDependent)),
              "Odchylenie ćwiartkowe"= ~(IQR(IncomePerDependent)/2),
              "Skośność"= ~(skew(IncomePerDependent)),
              "Kurtoza"= ~(kurtosi(IncomePerDependent)),
              "Min"= ~min(IncomePerDependent),
              "Max"= ~max(IncomePerDependent)
         ))
```

```{r biblioteki, echo=FALSE}
install.packages("ggstatsplot")
install.packages("corrplot")
install.packages("gtsummary")
library(gtsummary)
library(tidyverse)
library(readr)
library(ggplot2)
library(ggstatsplot)
library(corrplot)
library(dplyr)
```

```{r Rozklad w tabeli, echo=TRUE}
#Rozkład w tabeli
data1 %>%
  select(IncomePerDependent, Loan_Status) %>%
  tbl_summary(
    by=Loan_Status,
    type = all_continuous() ~ "continuous2",
    statistic = all_continuous() ~ c(
      "{N_nonmiss}","{mean}","{sd}",
      "{median} ({p25}, {p75})",
      "{min}, {max}"),
    missing = "no",
    label = IncomePerDependent ~ "Przychód na jedną osobę w gospodarstwie domowym") %>%
  modify_header(label ~ "**Zmienna**") %>%
  modify_caption("**Rozkład IncomePerDependent wg Loan_Status**") %>%
  bold_labels() %>% 
  add_p(pvalue_fun = ~ style_pvalue(.x, digits = 2))
```

Tabela przedstawia **rozkład przychodu na jedną osobę w gospodarstwie domowym** w podziale na **status kredytowy**, gdzie **0** oznacza osoby, którym kredytu nie przyznano (*N = 192*), a **1** oznacza osoby, które otrzymały kredyt (*N = 422*).

**5.2.** **Korelacja** pokazuje, czy i jak mocno dwie zmienne są ze sobą powiązane.

U nas wygląda to następująco:

```{r Korelacja, echo=TRUE}
#Badamy korelacje miedzy zmiennymi
korelacja <- data.frame(cor(data1))
korelacja
```

Zdecydowaliśmy się ograniczyć korelacje, aby ukazywały się tylko te **od 0,5 do 1** (korelacja silna).

```{r Wizualizacja korelacji, echo=TRUE}
wizualizacja_kor <- as.data.frame(as.table(cor(korelacja)))

bez_duplikatow <- wizualizacja_kor[order(wizualizacja_kor$Freq, decreasing = TRUE),]
bez_duplikatow <- distinct(bez_duplikatow, Freq, .keep_all = TRUE)

if (bez_duplikatow[1,1] == bez_duplikatow[1,2]) {
  bez_duplikatow <- bez_duplikatow[-1,]
  row.names(bez_duplikatow) <- NULL
}

silna_korelacja <- subset(bez_duplikatow, bez_duplikatow$Freq >= abs(0.5))
silna_korelacja
```

W celu bardziej przejrzystego przedstawienia danych, prezentujemy naszą **macierz korelacji**:

```{r Macierz korelac, echo=TRUE}
#Macierz korelacji
macierz_korelacji <- cor(korelacja, use="complete.obs")
corrplot(macierz_korelacji, method = "color", type = "upper", order = "hclust",
         tl.col = "black", tl.srt = 60)

```

Stąd od razu widzimy, które zmienne są ze sobą silnie skorelowane, a które słabiej.
